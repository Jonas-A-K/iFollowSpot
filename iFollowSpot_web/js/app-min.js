function degreeToDMX(t){return Math.round(65536*t/360*256/65536)}function resetSettings(){dmxPanCh=dmxPanChD,dmxTiltCh=dmxTiltChD,panCenter=panCenterD,tiltCenter=tiltCenterD,panMax=panMaxD,panMin=panMinD,tiltMax=tiltMaxD,tiltMin=tiltMinD}function displaySettings(){document.getElementById("pan-channel").value=dmxPanCh,document.getElementById("tilt-channel").value=dmxTiltCh,document.getElementById("pan-center").value=panCenter,document.getElementById("tilt-center").value=tiltCenter,document.getElementById("pan-max").value=panMax,document.getElementById("pan-min").value=panMin,document.getElementById("tilt-max").value=tiltMax,document.getElementById("tilt-min").value=tiltMin}function displayDMXStatus(){document.getElementById("pan").innerHTML=panDeg+"°",document.getElementById("tilt").innerHTML=tiltDeg+"°",document.getElementById("pan-ch-status").innerHTML=dmxPanCh,document.getElementById("tilt-ch-status").innerHTML=dmxTiltCh,document.getElementById("pan-dmx-value").innerHTML=pan,document.getElementById("tilt-dmx-value").innerHTML=tilt}function setMaxMinForCenter(){document.getElementById("pan-center").max=panMax,document.getElementById("pan-center").min=panMin,document.getElementById("tilt-center").max=tiltMax,document.getElementById("tilt-center").min=tiltMin}function checkMqttStatus(){1==client.connected?UIkit.notification("Connection Status: OK",{status:"success"}):UIkit.notification("Connection Status: Device unavailable",{status:"danger"})}function publishCommand(t,e){cmdObj={ch:t,value:e},cmdJSON=JSON.stringify(cmdObj),client.publish(topic,cmdJSON)}var client=mqtt.connect({host:"test.mosquitto.org",port:8080}),topic="ifollowspot/demo",dmxPanChD=2,dmxTiltChD=4,panCenterD=0,tiltCenterD=0,panMaxD=90,panMinD=-90,tiltMaxD=90,tiltMinD=-90,dmxPanCh=dmxPanChD,dmxTiltCh=dmxTiltChD,panCenter=panCenterD,tiltCenter=tiltCenterD,panMax=panMaxD,panMin=panMinD,tiltMax=tiltMaxD,tiltMin=tiltMinD,panDeg=panCenter,tiltDeg=panCenter,pan=degreeToDMX(panCenter),tilt=degreeToDMX(tiltCenter);document.addEventListener("DOMContentLoaded",function(){"undefined"!=typeof Storage?localStorage.settings?(UIkit.notification("Continuing with last saved state.",{status:"success"}),settings=JSON.parse(localStorage.settings),dmxPanCh=settings.dmxPanCh,dmxTiltCh=settings.dmxTiltCh,panCenter=settings.panCenter,tiltCenter=settings.tiltCenter,panMax=settings.panMax,panMin=settings.panMin,tiltMax=settings.tiltMax,tiltMin=settings.tiltMin,panDeg=panCenter,tiltDeg=panCenter,pan=degreeToDMX(panCenter),tilt=degreeToDMX(tiltCenter)):UIkit.notification("No saved state found. Continuing with default settings.",{status:"primary"}):UIkit.notification("This Browser doesn't support Web Storage. Settings can't be stored locally.",{status:"danger"}),setMaxMinForCenter(),displaySettings(),displayDMXStatus()}),client.subscribe(topic),client.on("message",function(t,e){switch(cmdString=e.toString(),cmdJSON=JSON.parse(cmdString),channel=cmdJSON.ch,value=cmdJSON.value,channel){case dmxPanCh:pan=value,panDeg=Math.round(65536*value/256*360/65536);break;case dmxTiltCh:tilt=value,tiltDeg=Math.round(65536*value/256*360/65536);break;default:break}displayDMXStatus()}),client.on("connect",function(t){UIkit.notification("Successfully connected to iFollowSpot device",{status:"success"}),document.getElementById("mqtt-status").setAttribute("uk-icon","link")}),client.on("reconnect",function(){document.getElementById("mqtt-status").setAttribute("uk-icon","clock")}),client.on("close",function(){0==client.reconnecting&&UIkit.notification("Connection has been closed.",{status:"warning"}),document.getElementById("mqtt-status").setAttribute("uk-icon","bolt")}),client.on("offline",function(){UIkit.notification("Client is offline.",{status:"danger"}),document.getElementById("mqtt-status").setAttribute("uk-icon","warning")}),client.on("error",function(t){UIkit.notification("An Error occured: "+t)});var timer,interval=100,leftControl=document.getElementById("left"),rightControl=document.getElementById("right"),upControl=document.getElementById("up"),downControl=document.getElementById("down");leftControl.addEventListener("mousedown",function(){timer=setInterval(function(){publishCommand(dmxPanCh,pan-1)},interval)}),rightControl.addEventListener("mousedown",function(){timer=setInterval(function(){publishCommand(dmxPanCh,pan+1)},interval)}),upControl.addEventListener("mousedown",function(){timer=setInterval(function(){publishCommand(dmxTiltCh,tilt+1)},interval)}),downControl.addEventListener("mousedown",function(){timer=setInterval(function(){publishCommand(dmxTiltCh,tilt-1)},interval)}),document.addEventListener("mouseup",function(){timer&&clearInterval(timer)});var panDMXControl=document.getElementById("pan-channel"),tiltDMXControl=document.getElementById("tilt-channel"),panCenterControl=document.getElementById("pan-center"),tiltCenterControl=document.getElementById("tilt-center"),panMaxControl=document.getElementById("pan-max"),panMinControl=document.getElementById("pan-min"),tiltMaxControl=document.getElementById("tilt-max"),tiltMinControl=document.getElementById("tilt-min"),saveControl=document.getElementById("save-settings"),resetControl=document.getElementById("reset-settings"),restoreControl=document.getElementById("restore-settings");panDMXControl.addEventListener("change",function(){dmxPanCh=this.value}),tiltDMXControl.addEventListener("change",function(){dmxTiltCh=this.value}),panCenterControl.addEventListener("change",function(){panCenter=this.value,publishCommand(dmxPanCh,degreeToDMX(panCenter))}),tiltCenterControl.addEventListener("change",function(){tiltCenter=this.value,publishCommand(dmxTiltCh,degreeToDMX(tiltCenter))}),panMaxControl.addEventListener("change",function(){panMax=this.value,publishCommand(dmxPanCh,degreeToDMX(panMax)),setMaxMinForCenter()}),panMinControl.addEventListener("change",function(){panMin=this.value,publishCommand(dmxPanCh,degreeToDMX(panMin)),setMaxMinForCenter()}),tiltMaxControl.addEventListener("change",function(){tiltMax=this.value,publishCommand(dmxTiltCh,degreeToDMX(tiltMax)),setMaxMinForCenter()}),tiltMinControl.addEventListener("change",function(){tiltMin=this.value,publishCommand(dmxTiltCh,degreeToDMX(tiltMin)),setMaxMinForCenter()}),saveControl.addEventListener("click",function(){settings={dmxPanCh:dmxPanCh,dmxTiltCh:dmxTiltCh,panCenter:panCenter,tiltCenter:tiltCenter,panMax:panMax,panMin:panMin,tiltMax:tiltMax,tiltMin:tiltMin},settingsString=JSON.stringify(settings),"undefined"!=typeof Storage?(localStorage.setItem("settings",settingsString),UIkit.notification("Your settings have been saved.",{status:"success"})):UIkit.notification("This browser doesn't support web storage. Settings can't be stored locally.",{status:"danger"})}),resetControl.addEventListener("click",function(){"undefined"!=typeof Storage?(localStorage.removeItem("settings"),UIkit.notification("Settings have been reset.",{status:"success"})):UIkit.notification("This browser doesn't support web storage.",{status:"danger"}),resetSettings(),displaySettings(),displayDMXStatus()}),restoreControl.addEventListener("click",function(){"undefined"!=typeof Storage?localStorage.settings?(UIkit.notification("Last save state successfully restored.",{status:"success"}),settings=JSON.parse(localStorage.settings),dmxPanCh=settings.dmxPanCh,dmxTiltCh=settings.dmxTiltCh,panCenter=settings.panCenter,tiltCenter=settings.tiltCenter,panMax=settings.panMax,panMin=settings.panMin,tiltMax=settings.tiltMax,tiltMin=settings.tiltMin,panDeg=panCenter,tiltDeg=panCenter,pan=degreeToDMX(panCenter),tilt=degreeToDMX(tiltCenter)):UIkit.notification("No saved state found.",{status:"primary"}):UIkit.notification("This Browser doesn't support Web Storage. Settings can't be restored.",{status:"danger"}),setMaxMinForCenter(),displaySettings(),displayDMXStatus()});
//# sourceMappingURL=./app-min.js.map